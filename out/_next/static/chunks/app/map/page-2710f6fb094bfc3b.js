(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[823],{2751:(e,t,r)=>{Promise.resolve().then(r.bind(r,3464))},6225:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(5155),l=r(2115),n=r(6046),o=r(8173),s=r.n(o),i=r(5565);let c=e=>{let{isAuthenticated:t,displayName:r}=e,o=(0,n.usePathname)(),[c,d]=(0,l.useState)(!1),u=r?r.charAt(0).toUpperCase():"P";return(0,a.jsxs)("nav",{className:"absolute top-0 left-0 w-full bg-white bg-opacity-90 shadow-md px-6 py-4 flex items-center justify-between z-50",children:[(0,a.jsx)(s(),{href:"/",children:(0,a.jsx)(i.default,{src:"/logo.jpg",alt:"Company Logo",width:200,height:80,className:"cursor-pointer"})}),"/login"!==o&&(0,a.jsx)(a.Fragment,{children:t&&(0,a.jsxs)("div",{className:"relative flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>d(e=>!e),className:"focus:outline-none","aria-label":"Toggle navigation menu",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-green-700 hover:text-green-800",fill:"none",stroke:"currentColor",strokeWidth:"3",viewBox:"0 0 20 10",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("polyline",{points:"0,0 10,10 20,0",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,a.jsx)(s(),{href:"/profile",children:(0,a.jsx)("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-700 hover:bg-green-800 text-white font-bold",children:u})}),c&&(0,a.jsx)("div",{className:"absolute right-0 top-full mt-2 w-40 bg-white border border-green-700 rounded-md shadow-lg z-50",children:(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:(0,a.jsx)(s(),{href:"/map",onClick:()=>d(!1),className:"block px-4 py-2 hover:bg-green-100 ".concat("/map"===o?"text-green-600":"text-green-800"),children:"Map"})}),(0,a.jsx)("li",{children:(0,a.jsx)(s(),{href:"/about",onClick:()=>d(!1),className:"block px-4 py-2 hover:bg-green-100 ".concat("/about"===o?"text-green-600":"text-green-800"),children:"About"})}),(0,a.jsx)("li",{children:(0,a.jsx)(s(),{href:"/image",onClick:()=>d(!1),className:"block px-4 py-2 hover:bg-green-100 ".concat("/image"===o?"text-green-600":"text-green-800"),children:"Image"})})]})})]})})]})}},9839:(e,t,r)=>{"use strict";r.d(t,{j:()=>s});var a=r(9904),l=r(4565),n=r(7058);let o=(0,a.Wp)({apiKey:"AIzaSyBY1AP28wPCEgRLpNw6oAI5Ut3_XTx1a0A",authDomain:"pathpetal-d19a1.firebaseapp.com",projectId:"pathpetal-d19a1",storageBucket:"pathpetal-d19a1.firebasestorage.app",messagingSenderId:"1034300337833",appId:"1:1034300337833:web:e22cf0f6385341382003b8",measurementId:"G-6Y6NB38T0H"}),s=(0,l.xI)(o);(0,n.aU)(o)},3464:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),l=r(2115),n=r(6225),o=r(161),s=r(2651),i=r(9839);let c=()=>{let e=(0,l.useRef)(null),[t,r]=(0,l.useState)(!0),[c,d]=(0,l.useState)(null),u=(0,l.useRef)([]),g=(0,l.useRef)(null),h=(0,l.useRef)(null),p=(0,l.useRef)(null),[m,f]=(0,l.useState)(null),[w,x]=(0,l.useState)(null),k=(0,l.useRef)([]);(0,l.useEffect)(()=>{let e=i.j.onAuthStateChanged(e=>{f(e)});return()=>e()},[]);let v=(0,l.useCallback)(e=>({path:window.google.maps.SymbolPath.CIRCLE,scale:15+0*Math.log2(e),fillColor:"#2d5b27",fillOpacity:.9,strokeColor:"#fff",strokeWeight:3}),[]),y=(e,t)=>{let r=e.lat*Math.PI/180,a=t.lat*Math.PI/180,l=(t.lat-e.lat)*Math.PI/180,n=(t.lng-e.lng)*Math.PI/180,o=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r)*Math.cos(a)*Math.sin(n/2)*Math.sin(n/2);return 12742e3*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))},b=(0,l.useCallback)(e=>{let t=[];return e.forEach(e=>{let r=!1;for(let a of t)if(1e3>y(e.midPoint,a.center)){a.trails.push(e),r=!0,a.center={lat:(a.center.lat+e.midPoint.lat)/2,lng:(a.center.lng+e.midPoint.lng)/2};break}r||t.push({center:e.midPoint,trails:[e],marker:null,displayName:e.name})}),t},[]),j=(0,l.useCallback)(e=>{var t,r,a,l;if(!(null===(t=window.google)||void 0===t?void 0:t.maps))return;if(h.current===e){e.trails.forEach(e=>e.polyline.setMap(null)),e.marker.setIcon(v(e.trails.length)),h.current=null;return}h.current&&(h.current.trails.forEach(e=>{e.polyline.setMap(null)}),h.current.marker.setIcon(v(h.current.trails.length))),e.trails.forEach(e=>{e.polyline.setMap(g.current),e.polyline.setOptions({strokeColor:"#FF0000",strokeWeight:6,strokeOpacity:.9,zIndex:2})}),e.marker.setIcon({...v(e.trails.length),fillColor:"#FF0000",scale:18+2*Math.log2(e.trails.length),path:window.google.maps.SymbolPath.CIRCLE});let n=new window.google.maps.LatLngBounds;e.trails.forEach(e=>{e.polyline.getPath().forEach(e=>n.extend(e))}),null===(r=g.current)||void 0===r||r.fitBounds(n),((null===(a=g.current)||void 0===a?void 0:a.getZoom())||13)>16&&(null===(l=g.current)||void 0===l||l.setZoom(16)),h.current=e},[v]),C=(0,l.useCallback)(async()=>{var e,t;if(g.current&&(null===(e=window.google)||void 0===e?void 0:e.maps))try{let e=(await s.A.get("https://overpass-api.de/api/interpreter?data=".concat(encodeURIComponent('\n      [out:json];\n      (\n        way["highway"~"path|footway"]["foot"="yes"](35.8,-79.4,36.4,-78.6);\n        way["route"="hiking"](35.8,-79.4,36.4,-78.6);\n        relation["route"="hiking"](35.8,-79.4,36.4,-78.6);\n      );\n      out geom;\n    ')))).data;if(!(null===(t=e.elements)||void 0===t?void 0:t.length)){d("No hiking trails found in this area");return}u.current.forEach(e=>{e.marker&&e.marker.setMap(null),e.trails.forEach(e=>e.polyline.setMap(null))}),u.current=[];let r=[];e.elements.forEach(e=>{var t,a;if(e.geometry&&(null===(t=e.tags)||void 0===t?void 0:t.name)){let t=e.geometry.map(e=>({lat:e.lat,lng:e.lon})),l=(null===(a=e.tags)||void 0===a?void 0:a.route)==="hiking",n=l?"#2d5b27":"#FF5733",o=l?4:3,s=new window.google.maps.Polyline({path:t,map:null,strokeColor:n,strokeOpacity:.9,strokeWeight:o}),i=t[Math.floor(t.length/2)];r.push({polyline:s,originalColor:n,originalWeight:o,name:e.tags.name,midPoint:i})}}),b(r).forEach(e=>{let t={};e.trails.forEach(e=>{t[e.name]=(t[e.name]||0)+1});let r=Object.entries(t).sort((e,t)=>t[1]-e[1])[0][0],a=new window.google.maps.Marker({position:e.center,map:g.current,icon:v(e.trails.length),title:r,zIndex:999}),l=new window.google.maps.InfoWindow({content:'\n            <div class="text-sm p-2">\n              <strong class="text-lg">'.concat(r,"</strong><br>\n              Contains ").concat(e.trails.length," trail segments\n            </div>\n          ")});a.addListener("click",()=>{p.current&&p.current.close(),j(e),l.open(g.current,a),p.current=l}),l.addListener("closeclick",()=>{p.current=null}),e.marker=a,e.displayName=r,u.current.push(e)})}catch(e){console.error("OSM Error:",e),d("Failed to load trail data")}},[b,j,v]),M=(0,l.useCallback)(async()=>{var e;if(g.current&&(null===(e=window.google)||void 0===e?void 0:e.maps))try{let e=(await s.A.get("".concat("http://127.0.0.1:5000","/getMarkers"))).data;console.log("Plant markers:",e),e.forEach(e=>{let{key:t,vars:r}=e,{lat:a,lng:l,image:n,desc:o}=r,s={lat:parseFloat(a),lng:parseFloat(l)},i=new window.google.maps.Marker({position:s,map:g.current,title:t,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"});i.addListener("click",()=>{x({name:t,image:n||"",latitude:a.toString(),longitude:l.toString(),description:o||""})}),k.current.push({key:t,lat:a,lng:l,image:n,desc:o,marker:i})})}catch(e){console.error("Error fetching plant markers:",e),e instanceof Error?d("Error fetching plant markers: "+e.message):d("Error fetching plant markers: An unknown error occurred.")}},[]),N=(0,l.useCallback)(()=>{var t;if(e.current&&(null===(t=window.google)||void 0===t?void 0:t.maps))try{g.current=new window.google.maps.Map(e.current,{center:{lat:36.0014,lng:-78.9382},zoom:13,mapTypeControl:!1,streetViewControl:!1}),C(),M(),r(!1)}catch(e){d("Failed to initialize Google Maps")}},[M,C]);return(0,l.useEffect)(()=>{var e;return(null===(e=window.google)||void 0===e?void 0:e.maps)?N():(()=>{let e="google-maps-script";if(document.getElementById(e))return;window.initGoogleMap=N;let t=document.createElement("script");t.id=e,t.src="https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyAnW73XPp_C30-yYzkzrt2QoRcC0ywHQ9o","&callback=initGoogleMap"),t.async=!0,t.defer=!0,t.onerror=()=>d("Failed to load Google Maps"),document.head.appendChild(t)})(),()=>{u.current.forEach(e=>{e.marker&&e.marker.setMap(null),e.trails.forEach(e=>e.polyline.setMap(null))}),k.current.forEach(e=>{e.marker.setMap(null)})}},[N]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed top-0 left-0 right-0 z-20",children:(0,a.jsx)(n.A,{isAuthenticated:!0,displayName:m?m.displayName||m.email:void 0})}),(0,a.jsxs)("div",{className:"relative h-screen bg-green-100",children:[t&&!c&&(0,a.jsx)("div",{className:"absolute z-10 top-16 left-1/2 transform -translate-x-1/2 text-lg text-gray-600",children:"Loading map..."}),c&&(0,a.jsxs)("div",{className:"absolute z-10 top-16 left-1/2 transform -translate-x-1/2 text-red-600",children:[c," - Please try refreshing the page"]}),(0,a.jsx)("div",{ref:e,className:"w-full h-full border-2 border-gray-300 rounded-lg shadow-lg overflow-hidden bg-white relative z-0"}),w&&(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full flex justify-center items-center",children:(0,a.jsx)(o.A,{name:w.name,image:w.image,latitude:w.latitude,longitude:w.longitude,description:w.description,onClose:()=>x(null),onDelete:(e,t,r)=>{let a=k.current.findIndex(a=>a.key===e&&a.lat.toString()===t&&a.lng.toString()===r);-1!==a&&(k.current[a].marker.setMap(null),k.current.splice(a,1)),x(null)}})})]})]})}},161:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(5155);r(2115);var l=r(2651);let n=e=>{let{name:t,image:r,latitude:n,longitude:o,description:s,onClose:i,onDelete:c}=e,d=async()=>{try{let e=new FormData;e.append("name",t),e.append("lat",n),e.append("lng",o);let r=await l.A.delete("".concat("http://127.0.0.1:5000","/delete_marker"),{headers:{"Content-Type":"multipart/form-data"},data:e});console.log("Response from delete_marker:",r),c(t,n,o)}catch(e){console.error("There was an error deleting the marker:",e)}};return(0,a.jsxs)("div",{className:"relative bg-white shadow-lg rounded-lg p-4 w-80 mx-auto mt-10",children:[(0,a.jsx)("button",{className:"absolute top-2 right-2 text-gray-500",onClick:i,children:"❌"}),(0,a.jsx)("img",{src:r,alt:t,className:"w-full h-40 object-cover rounded-lg"}),(0,a.jsx)("h2",{className:"text-lg font-bold mt-2",children:t}),(0,a.jsxs)("p",{className:"text-gray-600 text-sm",children:["\uD83D\uDCCD ",n,", ",o]}),(0,a.jsx)("p",{className:"mt-2 text-gray-700",children:s}),(0,a.jsx)("button",{className:"mt-4 bg-red-500 text-white px-4 py-2 rounded-md w-full hover:bg-red-600",onClick:d,children:"Delete Marker"})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,895,996,651,441,517,358],()=>t(2751)),_N_E=e.O()}]);